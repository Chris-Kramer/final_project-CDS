---
title: "map_bars"
author: "Christoffer Kramer"
date: "1/6/2021"
output: html_document
---


```{r cars}
library(tidyverse)
library(tmap)
pop_sqm <- read_csv("../rasmus/data/pop_sqm.csv") 

pop_avg_density <- pop_sqm %>% select(Kommune, people_pr_sqm_avg)
```

```{r}
library(sf)
#Read the municipalities polygons
municipalities <- readRDS("../data/raw_data/gadm36_DNK_2_sp.rds")
#Read municipalities as a spatial object
municipalities <- st_as_sf(municipalities)
#Give municipaliteis a CRS
municipalities <- st_transform(municipalities, crs = 4326)

#Clean names
municipalities$NAME_2[31] <- "Aarhus"
municipalities$NAME_2[21] <- "HÃ¸je-Taastrup"
municipalities$NAME_2[60] <- "Vesthimmerlands"
```

```{r}
#Merge data with municipalities
municipalities <- merge(pop_avg_density, municipalities, by.x = "Kommune", by.y = "NAME_2")

#Read municipalities as a spatial object
municipalities <- st_as_sf(municipalities)
#Give municipaliteis a CRS
municipalities <- st_transform(municipalities, crs = 4326)
```

```{r}
municipalities %>% filter(Kommune == "Esbjerg") %>% select(Kommune)

pop_avg_density %>% filter(Kommune == "Esbjerg")
```


```{r}
tmap_mode(mode = "view")
density_map <- tm_shape(municipalities) +
 tm_polygons("people_pr_sqm_avg", style = "quantile",
             id = "Kommune",
             title = "Average people pr. sqkm from 2010-2020")

tmap_save(density_map, "../output/density_map.html")

```

```{r}

tweets <- readRDS("../data/raw_data/twitter.rds")

tweets %>% filter(!is.na(geo_coords))

#geo <- tweets %>% filter(!is.na(geo_coords[0))

geo <- tweets$geo_coords
geo[1][1][1][1]

tweets$place_full_name

geo <- unlist(geo)

filter(is.na(geo) == FALSE)
geo[440:450]
```


